version: 2
jobs:
   build:
     working_directory: ~/angular8
     docker:
       - image: circleci/node:latest 

     steps:
       - checkout
       - restore_cache:
           key: sudo dependency-cache-{{ checksum "package-lock.json" }}
       - run:
           name: Install npm
           command: npm install
       - save_cache:
           key: sudo dependency-cache-{{ checksum "package-lock.json" }}
           paths:
             - node_modules
       - run:
           name: Install Dependencies
           command: npm install @angular/cli@8.3.20
      # - run:
      #     name: audit fix
       #    command: npm audit fix --force
       - run:
           name: Build Application
           command: npm run build
   
       
       - persist_to_workspace: 
           root: dist
           paths: 
             - ./   
       - run:
           name: Compress Artifacts
           command: tar -cvf buildartifact.tar dist

       - run:
           name: set identity 
           command: |
               git config --global user.email "suryawal.deepali@gmail.com"
               git config --global user.name "deep2131"
       
       - run:
           name: upload artifact
           command: |
               ls -ltr
               git clone git@github.com:deep2131/mynewrepo.git
               cd mynewrepo
               cd Build
               ls 
               git status
               cp ../buildartifact.tar . 
               git add buildartifact.tar
               git commit -m "artifact"
               git push --force origin master
               
           
       
workflows:
   version: 2
   build-deploy:
     jobs:
       - build
    
           
  
